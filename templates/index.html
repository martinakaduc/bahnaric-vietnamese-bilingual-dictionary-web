<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>Parallel Corpora</title>
  <!-- DataTable-->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap5.css" />
  <!-- Favicon-->
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  <!-- Bootstrap Icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Google fonts-->
  <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic"
    rel="stylesheet" type="text/css" />
  <!-- SimpleLightbox plugin CSS-->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet" />
</head>

<body id="ura-parallel-corpora">
  <!-- Navigation-->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
    <div class="container px-4 px-lg-5">
      <a class="navbar-brand" href="#ura-parallel-corpora">URA Parallel Corpora</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ms-auto my-2 my-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="#data">Ng·ªØ li·ªáu Kinh - Ba-na</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#data2">Ng·ªØ li·ªáu Ba-na - Kinh</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Masthead-->
  <header class="masthead">
    <div class="container px-4 px-lg-5 h-100">
      <div class="row gx-4 gx-lg-5 h-100 align-items-center justify-content-center text-center">
        <div class="col-lg-8 align-self-end">
          <h1 class="text-white font-weight-bold">
            Kho ng·ªØ li·ªáu song ng·ªØ ti·∫øng Ba-na
          </h1>
          <hr class="divider" />
        </div>
        <div class="col-lg-8 align-self-baseline">
          <p class="text-white-75 mb-5">
            Tra c·ª©u ti·∫øng Ba-na v√† nghe ph√°t √¢m t·ª´ ba ph∆∞∆°ng ng·ªØ B√¨nh ƒê·ªãnh,
            Kon Tum, Gia Lai.
          </p>
          <a class="btn btn-primary btn-xl" href="#kinh-bana">B·∫Øt ƒë·∫ßu</a>
        </div>
      </div>
    </div>
  </header>
  <!--Kinh - Bana-->
  <section class="page-section" id="kinh-bana">
    <div class="container px-4 px-lg-5">
      <h2 class="text-center mt-0">Ng·ªØ li·ªáu Kinh Ba-na</h2>
      <hr class="divider" />
      <div class="row gx-4 gx-lg-5">
        <div class="col-lg-8-text-left">
          <div class="row align-middle">
            <div class="col-9">
              <table id="data" class="table text-black mb-5 text-left table-hover">
                <thead>
                  <tr class="text-primary">
                    <th>Ti·∫øng Kinh</th>
                    <th>Ti·∫øng Ba-na</th>
                    <th>T·ª´ lo·∫°i</th>
                    <th>B√¨nh ƒê·ªãnh</th>
                    <th>Kon Tum</th>
                    <th>Gia Lai</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div style="height: 100px;"></div>
              
              <table id="data2" class="table text-black mt-5 mb-4 text-left table-hover">
                <thead>
                  <tr class="text-primary">
                    <th>Ti·∫øng Ba-na</th>
                    <th>Ti·∫øng Kinh</th>
                    <th>T·ª´ lo·∫°i</th>
                    <th>B√¨nh ƒê·ªãnh</th>
                    <th>Kon Tum</th>
                    <th>Gia Lai</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="col-3 h-100" id="word-detail">
              <!-- START SAMPLE CARD -->
              <div id="sample" class="card">
                <div class="card-body">
                  <h2 id="card-title">Ch·ªçn m·ªôt t·ª´</h2>
                  <h6 class="card-subtitle mb-2 text-muted">ƒê·ªÉ hi·ªÉn th·ªã t·ª´ lo·∫°i</h6>
                  <p class="card-text">V√† b·∫£n d·ªãch ti·∫øng Ba-na.</p>
                </div>
              </div>
              <!-- END SAMPLE CARD -->
              <!-- START WORD CARD -->
              <div id="word" class="card visually-hidden">
                <div class="card-body">
                  <h2 id="card-vie"></h2>
                  <h3 id="card-bah" class="card-subtitle mb-2 text-muted"></h3>
                  <h6 id="pos"></h6>

                  <div class="gender">
                    <span id="genderAsk">Ch·ªçn gi·ªçng ƒë·ªçc:</span>
                    <select id="genderSelect" class="form-select w-35 d-inline-block" onchange="genderChangeHandler()">
                      <option value="male">Nam</option>
                      <option value="female">N·ªØ</option>
                    </select>
                  </div>

                  <div id="card-button" class="visually-hidden">
                    <div class="row my-2 justify-content-center">
                      <button id="bdButton" onclick="playBD()" class="btn btn-primary w-50 text-left">üîä
                        B√¨nh ƒê·ªãnh</button>
                    </div>
                    <div class="row my-2 justify-content-center">
                      <button id="ktButton" onclick="playKT()" class="btn btn-primary w-50 text-left">üîä
                        Kon Tum</button>
                    </div>
                    <div class="row my-2 justify-content-center">
                      <button id="glButton" onclick="playGL()" class="btn btn-primary w-50 text-left">üîä
                        Gia Lai</button>
                    </div>
                  </div>

                  <div id="card-button_loading" class="mx-auto mt-3">
                    <div class="spinner-border" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </div>
                </div>
              </div>
              <!-- END WORD CARD -->
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>
  <!-- Footer-->
  <footer class="bg-light py-5">
    <div class="container px-4 px-lg-5">
      <div class="small text-center text-muted">
        Copyright &copy; 2022 - URA HCMUT
      </div>
    </div>
  </footer>
  <!-- Bootstrap core JS-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- SimpleLightbox plugin JS-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
  <!-- Core theme JS-->
  <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
  <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
  <script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.js"></script>
  <script>
    $(document).ready(function () {
      var table = $("#data").DataTable({
        ajax: "/api/data",
        serverSide: true,
        columns: [
          { data: "vietnamese", orderable: false, width: "30%" },
          { data: "bahnaric", orderable: false, width: "20%" },
          { data: "pos", orderable: false, width: "10%" },
          { data: "binhdinh", orderable: false },
          { data: "kontum", orderable: false },
          { data: "gialai", orderable: false },
        ],
        "order": [],
        language: {
          lengthMenu: "Hi·ªÉn th·ªã _MENU_ k·∫øt qu·∫£",
          search: "T√¨m ki·∫øm ti·∫øng Kinh:",
          zeroRecords: "Kh√¥ng c√≥ d·ªØ li·ªáu",
          info: "Trang _PAGE_/_PAGES_",
          infoEmpty: "Kh√¥ng t√¨m th·∫•y",
          infoFiltered: "(t·ªïng c·ªông _MAX_ k·∫øt qu·∫£)",
          paginate: {
            first: "Trang ƒë·∫ßu",
            previous: "Trang tr∆∞·ªõc",
            next: "Trang sau",
            last: "Trang cu·ªëi",
          },
        },
      });


      var table2 = $("#data2").DataTable({
        ajax: "/api/bahna",
        serverSide: true,
        columns: [
          { data: "bahnaric", orderable: false, width: "20%" },
          { data: "vietnamese", orderable: false, width: "30%" },
          { data: "pos", orderable: false, width: "10%" },
          { data: "binhdinh", orderable: false },
          { data: "kontum", orderable: false },
          { data: "gialai", orderable: false },
        ],
        "order": [],
        language: {
          lengthMenu: "Hi·ªÉn th·ªã _MENU_ k·∫øt qu·∫£",
          search: "T√¨m ki·∫øm ti·∫øng Bahna:",
          zeroRecords: "Kh√¥ng c√≥ d·ªØ li·ªáu",
          info: "Trang _PAGE_/_PAGES_",
          infoEmpty: "Kh√¥ng t√¨m th·∫•y",
          infoFiltered: "(t·ªïng c·ªông _MAX_ k·∫øt qu·∫£)",
          paginate: {
            first: "Trang ƒë·∫ßu",
            previous: "Trang tr∆∞·ªõc",
            next: "Trang sau",
            last: "Trang cu·ªëi",
          },
        },
      });
      // $('#data th:nth-child(1), #data th:nth-child(2)').each(function () {
      //   let title = $('#data thead th:nth-child(1), #data thead th:nth-child(2)').eq($(this).index()).text();
      //   $(this).html('<input type="text"/>')
      // })

      // table.columns().every(function () {
      //   let dataColumn = this

      //   $('input', this.header()).on('keyup change clear', function () {
      //     if (dataColumn.search() !== this.value) {
      //       dataColumn.search(this.value).draw();
      //     }
      //   })
      // })

      $("#data tbody").on("click", "tr", function () {
        const row = table.row(this).data();
        const myJSON = JSON.stringify(row);
        // console.log(myJSON);

        const myObj = JSON.parse(myJSON);
        UPDATE_GLOBAL_MYOBJ(myObj)
        updateCard()
      });
    });

    // GLOBAL
    let MYOBJ = undefined
    let GENDER = document.getElementById('genderSelect').value
    let SND = undefined;
    let SND_BD = undefined;
    let SND_KT = undefined;
    let SND_GL = undefined;
    const UPDATE_GLOBAL_MYOBJ = function (myObj) {
      MYOBJ = myObj
      console.log(myObj)
    }

    const updateCard = () => {
      //hide sample card (prompt for word choice)
      document.getElementById('sample').classList.add('visually-hidden')
      //show word card (chosen word)
      document.getElementById('word').classList.remove('visually-hidden')

      //update info to card
      document.getElementById('card-vie').innerHTML = MYOBJ["vietnamese"]
      document.getElementById('card-bah').innerHTML = MYOBJ["bahnaric"]
      document.getElementById('pos').innerHTML = MYOBJ["pos"]

      prepAudio()
    }


    const prepAudio = () => {
      callAltAPI(function () {
        if (MYOBJ["binhdinh"] === 'Y') {
          try {
            document.getElementById('sourceBD').setAttribute("src", `/audio/BD/${MYOBJ["bahnaric"]}`)
            console.log('BD')
          }
          catch (error) {
            document.getElementById('sourceBD').setAttribute("src", 'data:audio/mp3;base64,' + speechBase64)
            console.log('resolved')
          }
        }
        else
          document.getElementById('sourceBD').setAttribute("src", 'data:audio/mp3;base64,' + speechBase64)

        if (MYOBJ["kontum"] === 'Y') {
          try {
            document.getElementById('sourceKT').setAttribute("src", `/audio/KT/${MYOBJ["bahnaric"]}`)
            console.log('KT')
          }
          catch (error) {
            document.getElementById('sourceKT').setAttribute("src", 'data:audio/mp3;base64,' + speechBase64)
            console.log('resolved')
          }
        }
        else
          document.getElementById('sourceKT').setAttribute("src", 'data:audio/mp3;base64,' + speechBase64)

        if (MYOBJ["gialai"] === 'Y') {
          try {
            document.getElementById('sourceGL').setAttribute("src", `/audio/GL/${MYOBJ["bahnaric"]}`)
            console.log('GL')
          }
          catch (error) {
            document.getElementById('sourceGL').setAttribute("src", 'data:audio/mp3;base64,' + speechBase64)
            console.log('resolved')
          }
        }
        else
          document.getElementById('sourceGL').setAttribute("src", 'data:audio/mp3;base64,' + speechBase64)

        $('#audioBD').trigger('load')
        $('#audioKT').trigger('load')
        $('#audioGL').trigger('load')
      })
    }

    let speechBase64
    const callAltAPI = async (callback) => {
      loadSpeech()

      const data = {
        "text": MYOBJ["bahnaric"],
        "gender": GENDER
      };
      const response = await fetch('https://www.ura.hcmut.edu.vn/tts/speak', {
        method: "POST",
        headers: {
          "content-type": "application/json; charset=UTF-8"
        },
        body: JSON.stringify(data),

      });
      const responseJson = await response.json();
      const testVar = JSON.stringify(responseJson);

      speechBase64 = responseJson["speech"];

      // SND = new Audio("data:audio/mp3;base64," + speechBase64);

      console.log("API ready - Gender: " + GENDER)
      showSpeech()
      callback()
    }

    // let FILENAME
    // const callAPI = async (region, word, callback) => {
    //   const response = await fetch(`/audio/${region}/${word}`)
    //   FILENAME = await response.json()["string"]
    //   console.log(FILENAME)
    //   callback()
    // }

    // // let ENCODED_STRING
    // // const callAPI = async () => {
    // //   const response = await fetch(`/audio/GL/yol`)
    // //   ENCODED_STRING = await response.json()["string"]
    // //   console.log(ENCODED_STRING)
    // // }

    // // callAPI()

    // const prepAudio = () => {
    //   let gender
    //   if (GENDER === 'male')
    //     gender = 'M'
    //   else
    //     gender = 'FM'

    //   callAltAPI(function () {
    //     SND_BD = SND
    //     SND_KT = SND
    //     SND_GL = SND
    //     let path

    //     if (MYOBJ["binhdinh"] !== '-') {
    //       path = `{{ url_for('static', filename='assets/audio/Bana-BinhDinh/audio_by_word/${MYOBJ["bahnaric"]}/000_${gender}.mp3') }}`
    //       SND_BD = new Audio(path)
    //     }

    //     if (MYOBJ["kontum"] !== '-' && gender === 'FM') {
    //       callAPI('KT', MYOBJ["bahnaric"], function () {
    //         path = `{{ url_for('static', filename='assets/audio/Bana-KonTum/audio_by_word/${MYOBJ["bahnaric"]}/${FILENAME}') }}`
    //         SND_KT = new Audio(path)
    //       })
    //     }

    //     if (MYOBJ["gialai"] !== '-' && gender === 'FM') {
    //       callAPI('GL', MYOBJ["bahnaric"], function () {
    //         // path = `{{ url_for('static', filename='assets/audio/Bana-GiaLai/audio_by_word/yui/000.mp3') }}`
    //         SND_GL = new Audio("{{ url_for('static', filename='assets/audio/Bana-GiaLai/audio_by_word/yui/000.mp3') }}")
    //       })
    //     }
    //   })
    // }

    // const speechPlay = (snd) => {
    //   console.log(snd)
    //   snd.play()
    // }




    // const speechPlay = (region) => {
    //   if (region === 'BD')
    //     audioBD.play()
    //   if (region === 'KT')
    //     audioKT.play()
    //   if (region === 'GL')
    //     audioGL.play()

    //   console.log("Day", region)
    // }

    const genderChangeHandler = () => {
      GENDER = document.getElementById('genderSelect').value
      prepAudio()
    }

    const loadSpeech = () => {
      //hide button
      document.getElementById('card-button').classList.add('visually-hidden')

      //show loading icon
      document.getElementById('card-button_loading').classList.remove('visually-hidden')
    }

    const showSpeech = () => {
      //show button
      document.getElementById('card-button').classList.remove('visually-hidden')

      //hide loading icon
      document.getElementById('card-button_loading').classList.add('visually-hidden')
    }
  </script>


  <audio preload="none" id="audioBD">
    <source id="sourceBD" src="">
  </audio>
  <audio preload="none" id="audioKT">
    <source id="sourceKT" src="">
  </audio>
  <audio preload="none" id="audioGL">
    <source id="sourceGL" src="">
  </audio>


  <script>
    function playBD() {
      $('#audioBD').trigger('play')
    }

    function playKT() {
      $('#audioKT').trigger('play')
    }

    function playGL() {
      $('#audioGL').trigger('play')
    }
  </script>
</body>

</html>